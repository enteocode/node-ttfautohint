((t,e)=>{"use strict";var i=e("path"),n=e("child_process"),o=e("fs"),r=e("https"),a=e("mkdirp"),s=e("rimraf"),c=e("os"),l=function(t){return t&&"object"==typeof t&&"default"in t?t.default:t}(e("decompress"));const p=__dirname,h=((e=t.env)=>String(e.npm_package_config_repository).replace(/\/+$/,""))(),u=511&~t.umask(),f=(t,e,i=[])=>t.map(t=>t[e](...i)),d=(e=t.platform)=>"win32"===e?"ttfautohint".concat(".exe"):"ttfautohint",m=()=>i.join(p,"bin",d()),w=(t,e=0)=>new Promise((i,n)=>{const o=r.get(t);o.on("response",o=>{const{statusCode:r,headers:a}=o;if(r>300&&r<400&&0!==e)w(a.location,e-1).then(i).catch(n);else if(200!==r)n(`HTTP ${r} - ${t}`);else{const t=[];o.on("data",e=>{t.push(e)}),o.on("end",()=>{i(Buffer.concat(t))})}}),o.on("error",n)}),g=(t,e,n=u)=>{a.sync(i.dirname(t),n),o.writeFileSync(t,e,{mode:n})},y=(t=m())=>{const e=n.execFileSync(t,["--version"]),i=String(e).match(/[0-9]+\.[0-9]+(?:\.[0-9]+)?(?:-\w+)?/);return i?i[0]:""},b=(t,e=!1,i=console.log)=>{const n=["#","[ttfautohint]",t];e&&n.push("\r\n"),i(...n)},$=i.join(c.tmpdir(),"enteocode",((e=t.env)=>{const i=String(e.npm_package_name);return i?i.split("/").pop():""})()),_=i.join($,"build"),z=i.join($,"src"),S=i.join($,"tar"),F=i.join($,"build","bin",d()),v="-fPIC -g -O3",x=(t,e=[])=>[`CFLAGS="${v} -I${t}/include"`,`CXXFLAGS="${v} -I${t}/include"`,`LDFLAGS="-fPIC -L${t}/lib -L${t}/lib64"`,"--disable-shared","--enable-static",`--prefix="${t}"`,...e];class k{constructor(t,e,i=[]){this.tar="",this.src="",this.name=t,this.url=e,this.options=i}async download(t=S){if(""===this.tar){const e=i.basename(this.url),n=i.join(t,e);o.existsSync(n)||g(n,await w(this.url,3)),this.tar=n}return this}async extract(t=z){if(""===this.src){const e=i.join(t,this.name);a.sync(e),await l(this.tar,e,{strip:1}),this.src=e}return this}compile(t=_,e="install"){a.sync(t);const i={cwd:this.src,windowsHide:!0},o=[`./configure ${x(t,this.options).sort().join(" ")}`,"make",`make ${e}`];return new Promise((t,e)=>{n.exec(o.join(" && "),i,(i,n)=>{i?e(i):t(n)})})}}const C=m(),G=i.dirname(C),L=`${v} -I${_}/include`,P=`${L} -L${_}/lib -L${_}/lib64`,j=()=>{b(`Version (${y(F)})`,!0),a.sync(G),o.copyFileSync(F,C)};(async()=>{const e=((e=t.env)=>Boolean(e.npm_package_config_force_compile))();if(((e=t.env)=>void 0!==e.npm_execpath)()||((e,i=!0)=>{b(e instanceof Error?e.message:e,!0,console.error),i&&t.exit(1)})("This script cannot be processed outside of NPM"),!e){if((()=>o.existsSync(m()))())return void b(`Local binary found (${y(C)})`,!0);if((()=>o.existsSync(F))())return b("Cached binary found on temporary folder"),void j()}if(await(async()=>{s.sync(`${$}/(src|build)`)})(),!e&&((e=t.platform,i=t.arch)=>"darwin"===e||"win32"===e||"linux"===e&&"x64"===i)()){b(`Getting precompiled binary for ${((e=t.platform,i=t.arch)=>`${e.toUpperCase()}/${i}`)()}`);try{const e=((e=t.platform)=>[h,e,((e=t.env)=>String(e.npm_package_config_version))(),d()].join("/"))(),i=await w(e,3);return g(F,i),void j()}catch(t){b(t)}}b("Getting source packages");const i=[new k("freetype","https://download.savannah.gnu.org/releases/freetype/freetype-2.9.tar.gz",["--without-bzip2","--without-png","--without-zlib","--without-harfbuzz",'PKG_CONFIG=" "']),new k("harfbuzz","https://www.freedesktop.org/software/harfbuzz/release/harfbuzz-1.7.6.tar.bz2",["--disable-dependency-tracking","--disable-gtk-doc-html","--without-glib","--without-cairo","--without-fontconfig","--without-icu","PKG_CONFIG=true",`FREETYPE_CFLAGS="${L}/freetype2"`,`FREETYPE_LIBS="${P} -lfreetype"`]),new k("ttfautohint","https://download.savannah.gnu.org/releases/freetype/ttfautohint-1.8.1.tar.gz",["--disable-dependency-tracking","--without-qt","--without-doc",`--with-freetype-config="${_}/bin/freetype-config"`,"PKG_CONFIG=true",`HARFBUZZ_CFLAGS="${L}/harfbuzz"`,`HARFBUZZ_LIBS="${P} -lharfbuzz"`])];Promise.all(f(i,"download")).then(()=>{b("Extracting"),Promise.all(f(i,"extract")).then(async([t,e,i])=>{b("Compiling binaries"),await t.compile(),await e.compile(),await i.compile(_,"install-strip"),j()})})})()})(process,require);
